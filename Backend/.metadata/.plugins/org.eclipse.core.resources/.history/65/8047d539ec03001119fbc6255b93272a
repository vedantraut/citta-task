package com.citta.ctta_backend.service;

import java.util.List;

import org.springframework.stereotype.Service;

import com.citta.ctta_backend.dto.PageResponse;
import com.citta.ctta_backend.model.User;
import com.citta.ctta_backend.util.MockDataGenerator;


@Service
public class UserService {
	
	private final List<User> users = MockDataGenerator.generateUsers(150);

	public PageResponse<User> fetchUsers(int page, int pageSize, String sortBy, String sortOrder) {
		 simulateDelay();

        // 1️⃣ SORT FIRST
        List<User> processed = users.stream()
                .sorted(getComparator(sortBy, sortOrder))
                .toList();

        // 2️⃣ PAGINATE AFTER SORT
        int start = (page - 1) * pageSize;
        int end = Math.min(start + pageSize, processed.size());

        List<User> pagedData = processed.subList(start, end);

        return new PageResponse<>(pagedData, users.size());
	}
	
	private void simulateDelay() {
        try {
            Thread.sleep(800);
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }

}
